<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('global/meta'); -%>

    <!-- Title Page-->
    <title> <%= title %></title>

    <%- include('global/css'); -%>

</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- HEADER MOBILE-->
        <%- include('global/navigation_mobile'); -%>

        <!-- MENU SIDEBAR-->
        <%- include('global/navigation'); -%>

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <header class="header-desktop">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">

                        <div class="header-wrap">
                          <h3><i class="fas fa-suitcase"></i>&nbsp; <%= title %> </h3>
                          <%- include('global/header'); -%>
                        </div>
                    </div>
                </div>
            </header>
            <!-- END HEADER DESKTOP-->

            <div id="app">
              <div class="main-content">
                  <div class="section__content section__content--p30">
                      <div class="container-fluid">
                        <div class="row">
            							<div class="col-md-12">
            								<div class="card">
            									<div class="card-header">
            										<i class="mr-2 fa fa-list"></i>
            										<strong class="card-title">Daftar Barang</strong>
                                <button @click="resetModal()"type="button" class="btn btn-sm btn-success mb-1 float-right" data-toggle="modal" data-target="#tambahModal">
    								              <i class="fa fa-plus"></i>&nbsp; Tambah Baru
            										</button>
            									</div>
            									<div class="card-body">
                                <div class="table-responsive m-b-40">
                                    <table id="tableKategori" class="table table-borderless table-data3">
                                        <thead>
                                            <tr>
                                                <th>Barang</th>
                                                <th>Kategori</th>
                                                <th>Harga</th>
                                                <th>Stok</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="data in kategori">
                                              <td>
                                                  <div class="table-data__info">
                                                      <h6>Nama</h6>
                                                      <span>
                                                          <a><p>Kode Barang</p></a>
                                                      </span>
                                                  </div>
                                              </td>
                                              <td>Kategori</td>
                                              <td>
                                                  <div class="table-data__info">
                                                      <h6>Jual : </h6>
                                                      <span>
                                                          <a><p>Modal : </p></a>
                                                      </span>
                                                  </div>
                                              </td>
                                                <td>Stok + satuan</td>
                                                <td>
                                                  <button @click="loadModal(data)" type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#editModal">
                                                    <i class="fa fa-edit"></i>&nbsp; Edit
                                                  </button>
                                                  <button @click="loadModal(data)" type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#hapusModal">
                                                    <i class="fa fa-times"></i>&nbsp; Hapus
                                                  </button>

                                                </td>

                                            </tr>

                                        </tbody>
                                    </table>
                                </div>

            									</div>
            								</div>
            							</div>
            						</div>

                            <%- include('global/footer'); -%>
                      </div>
                  </div>
              </div>
              <!-- modal tambah -->
              <!-- ***modal ditaruh diluar main content agar layernya di atas main content*** -->
              <div class="modal fade" id="tambahModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="mediumModalLabel">Tambah Barang</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form action="" method="post">
                        <div class="form-group">
                            <label for="nama" class=" form-control-label">Nama Barang</label>
                            <input v-model="modal.nama" type="text" id="nama" placeholder="Masukkan Nama Kategori" class="form-control">
                        </div>                        
                        <div class="form-group">
                            <label for="kode" class=" form-control-label">Kode Kategori</label>
                            <input v-model="modal.kode" type="text" id="kode" placeholder="Masukkan Kode Kategori" class="form-control">
                        </div>
                        <div class="form-group">
                          <label for="textarea-input" class=" form-control-label">Detail Kategori</label>
                          <textarea v-model="modal.detail" name="textarea-input" id="textarea-input" rows="4" placeholder="Masukkan Detail Kategori" class="form-control"></textarea>
                        </div>
                        <div>
                          <button @click="addKategori" data-dismiss="modal" type="button" class="btn btn-primary btn-block btn-lg">Konfirmasi</button>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button  type="button" class="btn btn-secondary" data-dismiss="modal">Batalkan</button>

                    </div>
                  </div>
                </div>
              </div>
              <!-- end modal tambah -->
              <!-- modal edit -->
              <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="mediumModalLabel">Edit Kategori</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form action="" method="post">
                        <div class="form-group">
                            <label for="nama" class=" form-control-label">Nama Kategori</label>
                            <input v-model="modal.nama" type="text" id="nama" placeholder="Masukkan Nama Kategori" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="kode" class=" form-control-label">Kode Kategori</label>
                            <input v-model="modal.kode" type="text" id="kode" placeholder="Masukkan Kode Kategori" class="form-control">
                        </div>
                        <div class="form-group">
                          <label for="textarea-input" class=" form-control-label">Detail Kategori</label>
                          <textarea v-model="modal.detail" name="textarea-input" id="textarea-input" rows="4" placeholder="Masukkan Detail Kategori" class="form-control"></textarea>
                        </div>
                        <div>
                          <button @click="updateKategori(modal.id)" data-dismiss="modal" type="button" class="btn btn-primary btn-block btn-lg">Konfirmasi</button>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button  type="button" class="btn btn-secondary" data-dismiss="modal">Batalkan</button>

                    </div>
                  </div>
                </div>
              </div>
              <!-- end modal edit -->
              <!-- modal hapus -->
        			<div class="modal fade" id="hapusModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
        				<div class="modal-dialog modal-lg" role="document">
        					<div class="modal-content">
        						<div class="modal-header">
        							<h5 class="modal-title" id="mediumModalLabel">Hapus Kategori</h5>
        							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
        								<span aria-hidden="true">&times;</span>
        							</button>
        						</div>
        						<div class="modal-body">
                      <div class="row form-group">
                         <div class="col col-md-3">
                             <label class=" form-control-label">Nama Kategori</label>
                         </div>
                         <div class="col-12 col-md-9">
                             <p class="form-control-static">{{modal.nama}}</p>
                         </div>
                       </div>
                       <div class="row form-group">
                          <div class="col col-md-3">
                              <label class=" form-control-label">Kode Kategori</label>
                          </div>
                          <div class="col-12 col-md-9">
                              <p class="form-control-static">{{modal.kode}}</p>
                          </div>
                        </div>
                        <div class="row form-group">
                           <div class="col col-md-3">
                               <label class=" form-control-label">Detail</label>
                           </div>
                           <div class="col-12 col-md-9">
                               <p class="form-control-static">{{modal.detail}}</p>
                           </div>
                         </div>
  		              </div>
        						<div class="modal-footer">
        							<button type="button" class="btn btn-secondary" data-dismiss="modal">Batalkan</button>
        							<button @click="deleteKategori(modal.id)" data-dismiss="modal" type="button" class="btn btn-primary">Konfirmasi</button>
        						</div>
        					</div>
        				</div>
        			</div>
        			<!-- end modal hapus -->
            </div>
        </div>

    </div>

  <%- include('global/js'); -%>

  <!-- start vue app -->
  <script type="text/javascript">


    const  db = firebase.database();

    var app = new Vue({
      el: '#app',
      data: {
        modal : {
          id: '',
          nama: '',
          kode: '',
          satuan: '',
          harga_dasar: '',
          harga_jual: '',
          kategori: '',
          detail: '',
          stok: ''
        }

      },
      firebase: {
        kategori: db.ref('kategori'),
        barang: db.ref('barang')
      },
      methods: {
        resetModal(){
          this.modal.id = '';
          this.modal.nama = '';
          this.modal.kode = '';
          this.modal.satuan = '';
          this.modal.harga_dasar = '';
          this.modal.harga_jual = '';
          this.modal.kategori = '';
          this.modal.detail = '';
          this.modal.stok = '';
        },
        addBarang () {
          this.$firebaseRefs.barang.push({
            nama_barang: this.modal.nama,
            kode_barang: this.modal.kode,
            satuan: this.modal.satuan,
            harga_dasar: this.modal.harga_dasar,
            harga_jual: this.modal.harga_jual,
            kategori: this.modal.kategori,
            detail_barang: this.modal.detail,
            jumlah_stok: this.modal.stok

          });
          this.resetModal();
        },
        loadModal(data){
          this.modal.id = data['.key'];
          this.modal.nama = data.nama_barang;
          this.modal.kode = data.kode_barang;
          this.modal.satuan = data.satuan;
          this.modal.harga_dasar = data.harga_dasar;
          this.modal.harga_jual = data.harga_jual;
          this.modal.kategori = data.kategori;
          this.modal.detail = data.detail_barang;
          this.modal.stok = data.jumlah_stok;
        },
        deleteBarang (key) {
          this.$firebaseRefs.barang.child(key).remove();
          this.resetModal();
        },
        updateBarang(key) {
          this.$firebaseRefs.barang.child(key).set({
            nama_barang: this.modal.nama,
            kode_barang: this.modal.kode,
            satuan: this.modal.satuan,
            harga_dasar: this.modal.harga_dasar,
            harga_jual: this.modal.harga_jual,
            kategori: this.modal.kategori,
            detail_barang: this.modal.detail,
            jumlah_stok: this.modal.stok
          });
          this.resetModal();
        }
      }
    });
  </script>
  <!-- end vue app -->

</body>

</html>
<!-- end document-->
